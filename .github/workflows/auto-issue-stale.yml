---
name: Stale Issue and PR Detection

on:
  schedule:
    # Run daily at midnight UTC
    - cron: "0 0 * * *"
  workflow_dispatch:

permissions:
  contents: read
  issues: write
  pull-requests: write

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: true

jobs:
  stale:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Detect and close stale issues and PRs
        uses: actions/stale@v10
        with:
          # Issue stale detection configuration
          days-before-issue-stale: 60
          days-before-issue-close: 14

          # Issue stale and close messages
          stale-issue-message: >
            This issue has been inactive for 60 days and will be closed
            in 14 days unless there is activity. If this issue is still
            relevant, please comment or remove the `stale` label.
          close-issue-message: >
            This issue was automatically closed due to inactivity. If this
            issue is still relevant, please reopen it or create a new issue
            with updated context.

          # Issue label configuration
          stale-issue-label: stale

          # Exempt labels - issues with these labels are never stale
          exempt-issue-labels: >
            pinned,
            security,
            priority/critical,
            priority/high,
            do-not-close

          # PR stale detection configuration
          days-before-pr-stale: 30
          days-before-pr-close: 7

          # PR stale and close messages
          stale-pr-message: >
            This PR has been inactive for 30 days and will be closed
            in 7 days unless there is activity. If this PR is still
            relevant, please comment, push updates, or remove the `stale` label.
          close-pr-message: >
            This PR was automatically closed due to inactivity. If you'd like
            to continue this work, please reopen the PR or create a new one.

          # PR label configuration
          stale-pr-label: stale

          # Exempt labels - PRs with these labels are never stale
          exempt-pr-labels: >
            work-in-progress,
            do-not-close,
            priority/critical,
            priority/high

          # Remove stale label when updated
          remove-stale-when-updated: true

          # Operations per run - increase if needed
          operations-per-run: 100

          # Authentication
          repo-token: ${{ secrets.GITHUB_TOKEN }}
