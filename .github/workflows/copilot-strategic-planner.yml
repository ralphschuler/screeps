---
name: Copilot Strategic Planner

on:
  schedule:
    # Run every 6 hours to analyze bot performance and create improvement roadmaps
    - cron: "0 */6 * * *"
  workflow_dispatch:

permissions:
  contents: read
  issues: write

concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: false

jobs:
  strategic-planning:
    runs-on: ubuntu-latest
    timeout-minutes: 45
    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Run strategic planning analysis
        uses: ./.github/actions/copilot-exec
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          REPO_NAME: "${{ github.repository }}"
          RUN_ID: "${{ github.run_id }}"
          RUN_URL: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          SCREEPS_TOKEN: ${{ secrets.SCREEPS_TOKEN }}
          SCREEPS_SHARD: ${{ vars.SCREEPS_SHARD || 'shard3' }}
          GRAFANA_URL: ${{ vars.GRAFANA_URL || 'https://ralphschuler.grafana.net' }}
          GRAFANA_SERVICE_ACCOUNT_TOKEN: ${{ secrets.GRAFANA_SERVICE_ACCOUNT_TOKEN }}
        with:
          copilot-token: ${{ secrets.COPILOT_TOKEN }}
          prompt-path: .github/copilot/prompts/strategic-planner
          output-path: "reports/copilot/strategic-planner-${{ github.run_id }}.log"
          timeout: "40"
          verbose: "true"
          additional-mcp-config: '@.github/mcp/all-servers.json'

      - name: Upload strategic planning report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: strategic-planner-report-${{ github.run_id }}
          path: |
            reports/copilot/strategic-planner-${{ github.run_id }}.log
          retention-days: 30
